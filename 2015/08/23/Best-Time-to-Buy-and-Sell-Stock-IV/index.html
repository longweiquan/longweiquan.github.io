<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> LeetCode - Best Time to Buy and Sell Stock IV · Dragon Egg</title><meta name="description" content="LeetCode - Best Time to Buy and Sell Stock IV - Weiquan LONG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://longweiquan.github.com/atom.xml" title="Dragon Egg"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/longweiquan" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">LeetCode - Best Time to Buy and Sell Stock IV</h1><div class="post-info">Aug 23, 2015</div><div class="post-content"><p>Leetcode - Best Time to Buy and Sell Stock IV Solution</p>
<a id="more"></a>
<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote><p>Say you have an array for which the ith element is the price of a given stock on day i.
Design an algorithm to find the maximum profit. You may complete at most k transactions.</p>
<footer><strong>@LeetCode</strong><cite><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv/" target="_blank" rel="external">leetcode.com/problems/best-time-to-buy-and-sell-stock-iv</a></cite></footer></blockquote>
<h2 id="Analyse"><a href="#Analyse" class="headerlink" title="Analyse"></a>Analyse</h2><p>This problem can be solved by Dynamic Programming. Note, DP is good at solving best solution problems. We will use two
dimensional DP solution because the prices length and the transaction times will impact the results.</p>
<p>In DP problem, we need to find out the states and the approaches to reach next states. In this problem, an obvious state
is the best profits, note globalMax[][]. An implicit state is the best profits with the last selling on the last day, 
note lastMax[][]. And the best profit is between making the last transaction on the last day or not.
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// i represents days and j represents transactions</div><div class="line">global[<span class="string">i</span>][<span class="symbol">j</span>] = Max(global[<span class="string">i-1</span>][<span class="symbol">j</span>], lastMax[<span class="string">i</span>][<span class="symbol">j</span>])</div></pre></td></tr></table></figure></p>
<p>The problem is now transformed to calculate lastMax[i][j]. We have two approaches. The first one is based on the best 
profits until i-1 day with j-1 transaction and add a new transaction on the last day. The second approach based on the 
best profits with the last transaction on i-1 day, so we replace the last transaction to the i day.
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// prices represent the prices of stock</div><div class="line">diff = prices[i] - prices[i-1];</div><div class="line">lastMax[<span class="string">i</span>][<span class="symbol">j</span>] = Max(global[<span class="string">i-1</span>][<span class="symbol">j-1</span>]+diff, lastMax[<span class="string">i-1</span>][<span class="symbol">j</span>]+diff)</div></pre></td></tr></table></figure></p>
<h2 id="Solution-in-Java"><a href="#Solution-in-Java" class="headerlink" title="Solution in Java"></a>Solution in Java</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">int</span> maxProfit(<span class="keyword">int</span> k, <span class="keyword">int</span>[] prices) &#123;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> n = prices.length;</div><div class="line">    <span class="built_in">if</span> (n &lt; <span class="number">2</span> || k &lt;= <span class="number">0</span>)&#123;</div><div class="line">        <span class="built_in">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Dynamic Programming Data Array</span></div><div class="line"></div><div class="line">    <span class="comment">// Best profit array with last transaction on the last day</span></div><div class="line">    <span class="keyword">int</span>[][] lastMax = <span class="keyword">new</span> <span class="keyword">int</span>[n][k + <span class="number">1</span>];</div><div class="line"></div><div class="line">    <span class="comment">// Best profit array</span></div><div class="line">    <span class="keyword">int</span>[][] globalMax = <span class="keyword">new</span> <span class="keyword">int</span>[n][k + <span class="number">1</span>];</div><div class="line"></div><div class="line">    <span class="built_in">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="built_in">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= k; j++) &#123;</div><div class="line">            <span class="keyword">int</span> diff = prices[i] - prices[i - <span class="number">1</span>];</div><div class="line"></div><div class="line">            <span class="comment">// do a new transaction on the last day</span></div><div class="line">            <span class="comment">// or replace the last transaction if it was made yesterday</span></div><div class="line">            lastMax[i][j] = Math.<span class="built_in">max</span>(globalMax[i - <span class="number">1</span>][j - <span class="number">1</span>], lastMax[i - <span class="number">1</span>][j]) + diff;</div><div class="line"></div><div class="line">            <span class="comment">// Make the last transaction on the last day or not</span></div><div class="line">            globalMax[i][j] = Math.<span class="built_in">max</span>(globalMax[i - <span class="number">1</span>][j], lastMax[i][j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">return</span> globalMax[n - <span class="number">1</span>][k];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2015/08/23/Word-Break/" class="prev">PREV</a><a href="/2015/05/27/hexo/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'longweiquan';
var disqus_identifier = '2015/08/23/Best-Time-to-Buy-and-Sell-Stock-IV/';
var disqus_title = 'LeetCode - Best Time to Buy and Sell Stock IV';
var disqus_url = 'http://longweiquan.github.com/2015/08/23/Best-Time-to-Buy-and-Sell-Stock-IV/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//longweiquan.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://longweiquan.github.com">Weiquan LONG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-63462717-1",'auto');ga('send','pageview');</script></body></html>